//! require("deferred.js", "deferred")
//! require("ajax.js", "ajax")
var sp=function(){function a(a,b){var c=new deferred;b=b||{WithPictureDetail:"1",PictureSize:"Size_36px"};var e=new ContextInfo;e.Templates={},e.Templates.Fields={};var f={EffectivePresenceEnabled:"1",PresenceAlt:"User Presence"},g={id:a.AccountName,department:a.Role,jobTitle:a.Title,title:a.PreferredName,email:a.WorkEmail,picture:a.PictureURL,sip:a.SipAddress};return d.loadScripts("clienttemplates.js").done(function(){var a=RenderUserFieldWorker(e,b,g,f);c.resolve(a)}),c.promise()}var b=0,c={},d={loadScripts:function(a){a=Array.isArray(a)?a:[a];var b=new deferred;return d.context.webServerRelativeUrl.done(function(c){for(var d=0;d<a.length;d++)_v_dictSod[a[d]]||SP.SOD.registerSod(a[d],c+"/_layouts/15/"+a[d]);var e=a.map(function(a){var b=new deferred;return SP.SOD.loadMultiple([a],function(){b.resolve()}),b.promise()});deferred.all(e).done(b.resolve.bind(b))}),b.promise()},getJSON:function(a){return ajax.getJSON(a,"application/json; odata=verbose")},postJSON:function(a,b,c){b=b||{};var e=new deferred;return c?ajax.postJSON(a,b,"application/json; odata=verbose",{"X-RequestDigest":c,"Content-Type":"application/json; odata=verbose"}).done(e.resolve.bind(e)).fail(e.reject.bind(e)):d.context.digest.done(function(c){d.postJSON(a,b,c).done(e.resolve.bind(e)).fail(e.reject.bind(e))}),e.promise()},context:{pageInfo:function(a){var b=new deferred;if(_spPageContextInfo){var c=a?_spPageContextInfo[a]:_spPageContextInfo;b.resolve(c)}else d.loadScripts("sp.js").done(function(){var c=a?_spPageContextInfo[a]:_spPageContextInfo;b.resolve(c)});return b.promise()},get webServerRelativeUrl(){var a=new deferred;return d.context.pageInfo("webServerRelativeUrl").done(function(b){b=b.replace(/\/$/,""),a.resolve(b)}),a.promise()},get digest(){var a=new deferred;return d.context.webServerRelativeUrl.done(function(b){d.postJSON(b+"/_api/contextinfo",{},"temp").done(function(b){a.resolve(b.d.GetContextWebInformation.FormDigestValue)})}),a.promise()}},controls:{peoplePicker:function(a,c,e,f){e=e||[],e=Array.isArray(e)?e:[e],f=f||{},a.id=a.id||"ClientSidePeoplePicker_"+b++;var g={};g.PrincipalAccountType="User,DL,SecGroup,SPGroup",g.SearchPrincipalSource=15,g.ResolvePrincipalSource=15,g.AllowMultipleValues=!0,g.MaximumEntitySuggestions=50,g.Width="280px";for(var h in f)g[h]=f[h];d.loadScripts(["sp.js","clienttemplates.js","clientforms.js","clientpeoplepicker.js","autofill.js"]).done(function(){SPClientPeoplePicker_InitStandaloneControlWrapper(a.id,null,g);var b=a.id+"_TopSpan",d=SPClientPeoplePicker.SPClientPeoplePickerDict[b];d.AddUserKeys(e.join(";")),d.OnValueChangedClientScript=function(a,b){for(var d=new Array,e=0;e<b.length;e++)b[e].IsResolved&&(d[d.length]=b[e].Key);c(d)}})}},user:{getById:function(a){var b=new deferred;return d.context.webServerRelativeUrl.done(function(c){d.getJSON(c+"/_api/web/GetUserById("+a+")").done(b.resolve.bind(b)).fail(b.resolve.bind(b))}),b.promise()}},csom:{webparts:{getProperties:function(a){var b=new deferred,c=SP.ClientContext.get_current(),d=c.get_web().getFileByServerRelativeUrl(_spPageContextInfo.serverRequestPath),e=d.getLimitedWebPartManager(SP.WebParts.PersonalizationScope.shared),f=e.get_webParts();return c.load(f),c.executeQueryAsync(function(){for(var d=null,e=0;e<f.get_count()&&!d;e++){var g=f.get_item(e);g.get_id().toString()===a&&(d=g)}if(!d)return void b.reject("Web Part: "+a+" not found on page: "+_spPageContextInfo.webServerRelativeUrl);var h=d.get_webPart().get_properties();c.load(h),c.executeQueryAsync(function(){b.resolve(h,d,c)},function(){b.reject("Failed to load web part properties")})},function(){b.reject("Failed to load web part collection")}),b.promise()},saveProperties:function(a,b){var c=new deferred;return d.csom.webparts.getProperties(a).done(function(a,d,e){for(var f in b)a.set_item(f,b[f]);d.saveWebPartChanges(),e.executeQueryAsync(function(){c.resolve()},function(){c.reject("Failed to save web part properties")})}).fail(c.reject.bind(c)),c.promise()},updateProperties:function(a,b){var c=new deferred;return d.csom.webparts.getProperties(a).done(function(e){var f=b(e.get_fieldValues());d.csom.webparts.saveProperties(a,f).done(c.resolve.bind(c)).fail(c.reject.bind(c))}).fail(c.reject.bind(c)),c.promise()}},user:{profileProperties:function(a,b){var c=new deferred;return a===parseInt(a)?d.user.getById(a).done(function(a){d.csom.user.profileProperties(a.d.LoginName,b).done(c.resolve.bind(c)).fail(c.reject.bind(c))}).fail(function(){c.reject("Error encountered resolving user with Id: "+a)}):d.loadScripts(["sp.js","SP.UserProfiles.js"]).done(function(){var d=SP.ClientContext.get_current(),e=new SP.UserProfiles.UserProfilePropertiesForUser(d,a,b),f=new SP.UserProfiles.PeopleManager(d),g=f.getUserProfilePropertiesFor(e);d.load(e),d.executeQueryAsync(function(){for(var a={},d=0;d<b.length;d++)a[b[d]]=g[d];c.resolve(a)},function(){c.reject("Unable to load profile for user: "+a+" -- Properties: "+b.join(", "))})}),c.promise()},renderUserPresence:function(b,e){var f=new deferred;if(c[b])c[b].html?f.resolve(c[b].html):c[b].deferreds.push(f);else{c[b]={deferreds:[],html:null};var g=["PreferredName","PictureURL","AccountName","Title","WorkEmail","SipAddress"];d.csom.user.profileProperties(b,g).done(function(d){a(d,e).done(function(a){c[b].html=a;for(var d=0;d<c[b].deferreds.length;d++)c[b].deferreds[d].resolve(a);f.resolve(a)})})}return f.promise()}}},page:{get inEditMode(){var a=null;document.forms[MSOWebPartPageFormName].MSOLayout_InDesignMode&&(a="1"==document.forms[MSOWebPartPageFormName].MSOLayout_InDesignMode.value);var b=null;return document.forms[MSOWebPartPageFormName]._wikiPageMode&&(b="Edit"==document.forms[MSOWebPartPageFormName]._wikiPageMode.value),!(!a&&!b)}}};return"undefined"!=typeof exports&&exports(d),d}();