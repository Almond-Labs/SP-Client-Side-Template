//! require("deferred.js", "deferred")
//! require("ajax.js", "ajax")
var sp=function(){var a={loadScripts:function(b){b=Array.isArray(b)?script:[b];var c=new deferred;return a.context.webServerRelativeUrl.done(function(a){for(var d=0;d<b.length;d++)_v_dictSod[b[d]]||SP.SOD.registerSod(b[d],a+"/_layouts/15/"+b[d]);SP.SOD.loadMultiple(b,c.resolve.bind(c))}),c.promise()},getJSON:function(a){return ajax.getJSON(a,"application/json; odata=verbose")},postJSON:function(b,c,d){c=c||{};var e=new deferred;return d?ajax.postJSON(b,c,"application/json; odata=verbose",{"X-RequestDigest":d,"Content-Type":"application/json; odata=verbose"}).done(e.resolve.bind(e)).fail(e.reject.bind(e)):a.context.digest.done(function(d){a.postJSON(b,c,d).done(e.resolve.bind(e)).fail(e.reject.bind(e))}),e.promise()},context:{pageInfo:function(b){var c=new deferred;if(_spPageContextInfo){var d=b?_spPageContextInfo[b]:_spPageContextInfo;c.resolve(d)}else a.loadScripts("sp.js").done(function(){var a=b?_spPageContextInfo[b]:_spPageContextInfo;c.resolve(a)});return c.promise()},get webServerRelativeUrl(){var b=new deferred;return a.context.pageInfo("webServerRelativeUrl").done(function(a){a=a.replace(/\/$/,""),b.resolve(a)}),b.promise()},get digest(){var b=new deferred;return a.context.webServerRelativeUrl.done(function(c){a.postJSON(c+"/_api/contextinfo",{},"temp").done(function(a){b.resolve(a.d.GetContextWebInformation.FormDigestValue)})}),b.promise()}},user:{getById:function(b){var c=new deferred;return a.context.webServerRelativeUrl.done(function(d){a.getJSON(d+"/_api/web/GetUserById("+b+")").done(c.resolve.bind(c)).fail(c.resolve.bind(c))}),c.promise()}},csom:{webparts:{getProperties:function(a){var b=new deferred,c=SP.ClientContext.get_current(),d=c.get_web().getFileByServerRelativeUrl(_spPageContextInfo.serverRequestPath),e=d.getLimitedWebPartManager(SP.WebParts.PersonalizationScope.shared),f=e.get_webParts();return c.load(f),c.executeQueryAsync(function(){for(var d=null,e=0;e<f.get_count()&&!d;e++){var g=f.get_item(e);g.get_id().toString()===a&&(d=g)}if(!d)return void b.reject("Web Part: "+a+" not found on page: "+_spPageContextInfo.webServerRelativeUrl);var h=d.get_webPart().get_properties();c.load(h),c.executeQueryAsync(function(){b.resolve(h,d,c)},function(){b.reject("Failed to load web part properties")})},function(){b.reject("Failed to load web part collection")}),b.promise()},saveProperties:function(b,c){var d=new deferred;return a.csom.webparts.getProperties(b).done(function(a,b,e){for(var f in c)a.set_item(f,c[f]);b.saveWebPartChanges(),e.executeQueryAsync(function(){d.resolve()},function(){d.reject("Failed to save web part properties")})}).fail(d.reject.bind(d)),d.promise()},updateProperties:function(b,c){var d=new deferred;return a.csom.webparts.getProperties(b).done(function(e){var f=c(e.$5_0.$1h_0.$m_dict);a.csom.webparts.saveProperties(b,f).done(d.resolve.bind(d)).fail(d.reject.bind(d))}).fail(d.reject.bind(d)),d.promise()}},user:{profileProperties:function(b,c){var d=new deferred;return b===parseInt(b)?a.user.getById(b).done(function(b){a.csom.user.profileProperties(b.d.LoginName,c).done(d.resolve.bind(d)).fail(d.reject.bind(d))}).fail(function(){d.reject("Error encountered resolving user with Id: "+b)}):a.loadScripts("SP.UserProfiles.js").done(function(){var a=SP.ClientContext.get_current(),e=new SP.UserProfiles.UserProfilePropertiesForUser(a,b,c),f=new SP.UserProfiles.PeopleManager(a),g=f.getUserProfilePropertiesFor(e);a.load(e),a.executeQueryAsync(function(){for(var a={},b=0;b<c.length;b++)a[c[b]]=g[b];d.resolve(a)},function(){d.reject("Unable to load profile for user: "+b+" -- Properties: "+c.join(", "))})}),d.promise()},renderUserPresence:function(b,c){c=c||{WithPictureDetail:"1",PictureSize:"Size_36px"};var d=new deferred,e=["PreferredName","PictureURL","AccountName","Title","WorkEmail","SipAddress"];return a.csom.user.profileProperties(b,e).done(function(b){var e=new ContextInfo;e.Templates={},e.Templates.Fields={};var f={EffectivePresenceEnabled:"1",PresenceAlt:"User Presence"},g={id:b.AccountName,department:b.Role,jobTitle:b.Title,title:b.PreferredName,email:b.WorkEmail,picture:b.PictureURL,sip:b.SipAddress};a.loadScripts("clienttemplates.js").done(function(){var a=RenderUserFieldWorker(e,c,g,f);d.resolve(a)})}),d.promise()}}},page:{get inEditMode(){var a=null;document.forms[MSOWebPartPageFormName].MSOLayout_InDesignMode&&(a="1"==document.forms[MSOWebPartPageFormName].MSOLayout_InDesignMode.value);var b=null;return document.forms[MSOWebPartPageFormName]._wikiPageMode&&(b="Edit"==document.forms[MSOWebPartPageFormName]._wikiPageMode.value),!(!a&&!b)}}},b={modulePlaceholder:!0};return b.exports=a}();